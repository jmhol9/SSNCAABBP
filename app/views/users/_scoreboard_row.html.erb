<!-- Process scoreboard query into array with subarrs for each user's results -->

<% # get all the usernames
  teams = []
    scoreboard.each do |row|
    teams << row["team_name"]
  end
  teams = teams.uniq.sort
 %>

<%  results_arr = [] %>
<%  teams.each do |team|
      team_results = [team]
      %(1 2 3 4 5 6).each do |round|
        matched_row =
          scoreboard
          .find {|row| row["team_name"] == team && row["round_id"] == round}

        points = matched_row ? matched_row["points"].to_i : 0
        team_results << points
      end

      team_results << team_results[1..-1].inject(:+)
      results_arr << team_results
    end

  results_arr.sort_by! {|result| result[-1] * -1}
%>

<% results_arr.each do |row| %>
  <tr>
  <% row.each do |index| %>
    <td><%= index %></td>
  <% end %>
  </tr>
<% end %>

</table>


<!-- Sort by last row is not working because sometiems the last row (integer
     score) isn't reached (ie, when there is only one round score and the above
     processor never reached the "last" condition).

     In those cases, this is attempting to sort strings and failing.

     ALSO, the scores are not necessarily coming out in order; may need to
     select the rows where team_name or name match, then sort by round, then
     add up scores push into ordered array

     ALSO, still multiplying one seeds by 1, not 1.5.
     -->


